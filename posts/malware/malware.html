<!DOCTYPE html>
<html lang="en" mode="dark">

<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <script>
        window.dataLayer = window.dataLayer || [];

        function gtag() {
            dataLayer.push(arguments);
        }
        gtag('js', new Date());
        gtag('config', 'UA-175469707-1');
    </script>
    <title>Bypass malware detection using Obfuscation | Mr Akuma</title>
    <meta name="generator" content="Jekyll v3.9.0" />
    <meta property="og:title" content="Bypassing malware detection" />
    <meta name="author" content="Mr Akuma" />
    <meta property="og:locale" content="en_US" />
    <meta name="description"
        content="The information provided in this site is for educational purposes regarding pentesting. The author of the site will not be held any responsibility for any misuse of the information from this site." />
    <meta property="og:description"
        content="The information provided in this site is for educational purposes regarding pentesting. The author of the site will not be held any responsibility for any misuse of the information from this site." />

    <link rel="icon" href="../../images/title.jpeg" />

    <link rel="shortcut icon" href="../../img/favicon.ico" type="image/x-icon">
    <link rel="icon" href="../../img/favicon.ico" type="image/x-icon">
    <meta name="msapplication-TileColor" content="#ffffff">
    <meta name="theme-color" content="#ffffff">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin="anonymous">
    <link rel="dns-prefetch" href="https://fonts.gstatic.com">
    <link rel="dns-prefetch" href="cdn.jsdelivr.net">
    <link rel="preload" as="style" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.0.0/dist/css/bootstrap.min.css"
        integrity="sha256-LA89z+k9fjgMKQ/kq4OO2Mrf8VltYml/VES+Rg0fh20=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"
        integrity="sha256-+N4/V/SbAFiW1MPBCXnfnP9QSN3+Keu+NlB+0ev/YKQ=" crossorigin="anonymous">
    <!-- CSS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed -->
    <link rel="preload" as="style" href="../../css/post.css">
    <link rel="stylesheet" href="../../css/post.css">
    <link rel="preload" as="style" href="../../css/bootstrap-toc.min.css">
    <link rel="stylesheet" href="../../css/bootstrap-toc.min.css" />
    <link rel="preload" as="script" href="https://cdn.jsdelivr.net/npm/jquery@3.4.1"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.4.1"
        integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/combine/npm/popper.js@1.15.0,npm/bootstrap@4.0.0/dist/js/bootstrap.min.js"
        async></script>
    <!-- JS selector for site. Chirpy v2.3 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT Licensed -->
    <script src="../../js/post.min.js" async></script>
    <script src="../../js/app.js" defer></script>

<body data-spy="scroll" data-target="#toc">
    <div id="sidebar" class="d-flex flex-column">
        <!-- The Side Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License -->
        <div id="nav-wrapper">
            <div id="profile-wrapper" class="d-flex flex-column">
                <div id="avatar" class="d-flex justify-content-center"> <a href="/" alt="avatar"> <img
                            src="../../images/title.jpeg" alt="avatar" onerror="this.style.display='none'">
                    </a></div>
                <div class="profile-text mt-3">
                    <div class="site-title"> <a href="/">Mr Akuma</a></div>
                    <div class="site-subtitle font-italic">Publish write-ups from various pentesting platforms.</div>
                </div>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item d-flex justify-content-center "> <a href="../../index.html"
                        class="nav-link d-flex justify-content-center align-items-center w-100"> <i
                            class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a></li>

                <li class="nav-item d-flex justify-content-center "> <a href="../../whoami.html"
                        class="nav-link d-flex justify-content-center align-items-center w-100"> <i
                            class="fa-fw fas fa-info ml-xl-3 mr-xl-3 unloaded"></i> <span>WHOAMI</span> </a></li>
            </ul>
        </div>
        <div class="sidebar-bottom d-flex flex-wrap justify-content-around mt-4"> <a
            href="https://github.com/akshay1729" target="_blank"> <i class="fab fa-github-alt"></i> </a> <a
            href="https://twitter.com/Akshayjain890" target="_blank"> <i class="fab fa-twitter"></i> </a> <a
            href=" javascript:window.open('mailto:' + ['Akshayjain5','protonmail.com'].join('@'))"><i
               class="fas fa-envelope"></i> </a> <a href="https://www.linkedin.com/in/akshay-jain-533a79111/"> <i
               class="fab fa-linkedin"></i> </a> <a href="https://www.hackthebox.eu/profile/189220"> <i
               class="fas fa-cube"></i> </a></div>

    </div><!-- The Top Bar v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License -->
    <div id="topbar-wrapper" class="row justify-content-center topbar-down">
        <div id="topbar" class="col-11 d-flex h-100 align-items-center justify-content-between"> <span id="breadcrumb">
                <span> <a href="../../index.html"> Article </a> </span> <span>Bypassing malware detection using Obfuscation</span> </span> <i id="sidebar-trigger"
                class="fas fa-bars fa-fw"></i>
            <div id="topbar-title"> Article</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span
                id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input
                    class="form-control" id="search-input" type="search" placeholder="Search..."> <i
                    class="fa fa-times-circle fa-fw" id="search-cleaner"></i> </span> <span
                id="search-cancel">Cancel</span>
        </div>
    </div>
    <div id="main-wrapper">
        <div id="main">
            <!-- Fixed kramdown code highlight rendering: https://github.com/penibelst/jekyll-compress-html/issues/101 https://github.com/penibelst/jekyll-compress-html/issues/71#issuecomment-188144901 -->
            <div class="row">
                <div id="post-wrapper" class="col-12 col-lg-11 col-xl-8">
                    <div class="post pl-1 pr-1 pl-sm-2 pr-sm-2 pl-md-4 pr-md-4">
                        <h1 data-toc-skip>How I bypass malware detection using Obfuscation</h1>
                        <div class="post-meta text-muted d-flex flex-column">
                            <div> Posted
                                <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License -->
                                <span class="timeago " data-toggle="tooltip" data-placement="bottom"
                                    title="Sun, Aug 4, 2019, 10:00 PM +0530"> Aug 4<i
                                        class="unloaded">2019-08-04T20:00:00+05:30</i> </span> by <span class="author">
                                    Mr Akuma </span></div>
                            <div> Updated
                                <!-- Date format snippet v2.4.1 https://github.com/cotes2020/jekyll-theme-chirpy © 2020 Cotes Chung MIT License -->
                                <span class="timeago lastmod" data-toggle="tooltip" data-placement="bottom"
                                    title="Sun, Aug 4, 2019, 10:00 PM +0530"> Sep 9 <i
                                        class="unloaded">2019-08-04T20:00:00+05:30</i> </span></div>
                        </div>
                        <div class="post-content"> <img src="cover.png">
                            <blockquote>
                                <p><strong>The information provided in this site is for educational purposes regarding
                                        pentesting. The author of the site will not be held any responsibility for any
                                        misuse of the information from this site.</strong></p>
                            </blockquote>
                            <h2 id="introduction"><strong><span style="color:#ff5555">Introduction</span></strong></h2>
                            <hr />
                            <p>Every day thousands of malware are released online malware wants to stay hidden during infection and operation to prevent removal and analysis, this Malware achieves this using many techniques to bypass detection one of the method is obfuscation this method can be used to cover filename/signature, changing the malware attributes or other methods, it can also be defined as a practice of making something difficult to understand.
                            <h2 id="let-start"><strong><span style="color:#ff5555">Lets Start!</span></strong></h2>
                            <hr />
                            <p>An attacker will typically employ file-less Malware like Shellcode(a piece of binary data that is meant to be executed by a process) to avoid detection but modern Anti-virus engines are much smarter at detecting potential threats, they also respond much quicker. As soon as your code behavior is something too malicious-looking its either blocked or tossed out from your system.</p>
                            <p>Let’s see an examples of practical obfuscation used in various malware today.
                            <h2 id="generating_a_payload"><strong><span style="color:#ff5555">Generating a Payload
                            </span></strong></h2>
                            <hr />
                            <p>Shellcode can be generated from the various frameworks.</p>
                            <p><strong style="color:antiquewhite">Step1:-</strong> Run Kali Linux os and download OWASP-ZSC, <code class="language-plaintext highlighter-rouge">OWASP-ZSC</code> is not built-in Kali Linux so it needs to be downloaded externally from github.com</p>
                            <p><code class="language-plaintext" style="color:firebrick;">root@kali:~# git clone https://github.com/zscproject/OWASP-ZSC</code><img src="1.png" alt=""/></p>
                            <hr />
                            <p><strong style="color:antiquewhite">Step 2:-</strong>Move the terminal to the OWASP-ZSC folder</p>
                            <p><code class="language-plaintext highlighter-rouge">root@kali: > cd OWASP-ZSC</code></p>
                            <hr>
                            <p><strong style="color:antiquewhite">Step3:-</strong> Now run the following command in the terminal</p>
                            <p><code class="language-plaintext highlighter-rouge">root@kali:# ./installer.py</code></p>
                            <p><img src="2.png" alt=""/></p>
                            <hr>
                            <p><strong style="color:antiquewhite">Step4:-</strong>The below command allows running the tool easily by typing zsc on the terminal<p>
                            <p><code class="language-plaintext highlighter-rouge">root@kali:#zsc</code></p>
                            <p><img src="3.png" alt=""/></p>
                            <hr>
                            <strong style="color:antiquewhite">Step5:-</strong>-Now, let’s generate some shellcode.<p>
                            <p><code class="language-plaintext highlighter-rouge">zsc> shellcode <br> zsc/shellcode> generate</code></p>
                            <p>   OWASP-ZSC uses the TAB key to show options for any command, so now we use the TAB to show the shellcode options.</p>
                            <p>As you can see below, OWASP_ZSC has three OS shellcode options, <span style="color:black;" class="highlighter-rouge">linux_x86, osx_x86 and windows_x86</span> Since most of us use windows operating system</p>
                            <p><code class="language-plaintext highlighter-rouge">zsc/shellcode/generate>windows_x86</code></p>
                            <p><img src="4.png" alt=""/></p>
                            <hr>
                            <p><strong style="color:antiquewhite">Step6:-</strong>Now to generate shellcode for windows_x86 so we press tab and select shellcode from the option<p>
                            <p><code class="language-plaintext highlighter-rouge">zsc/shellcode/generate>windows_x86>add_admin</code></p>
                            <p><img src="5.png" alt=""/></p>
                            <hr>
                            <p><strong style="color:antiquewhite">Step7:-</strong>you can also search for various shellcode from the www.shell-storm.org and shell-storm.org to increase the shellcode spectrum<p>
                            <p><code class="language-plaintext highlighter-rouge">zsc/shellcode/generate/windows_x86/add_admin> username&amp;&amp;password
                            </code></p>
                            <p>enter username and password</p>
                            <p><img src="6.png" alt=""/></p>
                            <hr>
                            <p><strong style="color:antiquewhite">Step8:-</strong>Now select the type of method you want to chose to encode with random XOR (xor_random). The random encodes produce shellcode that is different each time making it more likely to be undetected by AV<p>
                            <p><code class="language-plaintext highlighter-rouge">zsc/shellcode/generate/windows_x86/add_admin/encode_type> xor_random
                            </code></p>
                            <p><img src="7.png" alt=""/></p>
                            <hr>
                            <p><strong style="color:antiquewhite">Step9:-</strong>OWASP-ZSC prompts whether you want to output the assembly code and whether I want to output my shellcode to the screen.</p>
                            <p><img src="8.png" alt=""/></p>
                            <hr>
                            <p><strong style="color:antiquewhite">Step10:-</strong>The process of obfuscation is an attempt to hide the real purpose of the code and making it hard to read or reverse engineer the file-less malware. (obfuscation)</p>
                            <p>next, we start the obfuscation process</p>
                            <p><code class="language-plaintext highlighter-rouge">zsc > obfuscate</code></p>
                            <p>javascript, Perl, PHP, python, ruby are the available options</p>
                            <hr>
                            <p><strong style="color:antiquewhite">Step11:-</strong> Now to generate an encoded shellcode we select the type of encoding from the options<p>
                            <p><code class="language-plaintext highlighter-rouge">zsc/shellcode/generate/windows_x86/add_admin/encode_type> xor_random
                            </code></p>
                            <p><img src="9.png" alt=""/></p>
                            <p>below you can see the Assembly code generated after the xor_random obfuscation</p>
                            <p><img src="10.png" alt=""/></p>
                            <center><a href="https://pastebin.com/MvxpcuMp">you can check the complete code at Paste bin</a></center><hr>
                            <p><strong style="color:antiquewhite">Step12:-</strong>its time to test our shellcode whether it is detected by any antivirus to test the shellcode you can visit <a href="https://www.virustotal.com">www.virustotal.com</a> and upload the shellcode and scan</p>
                            <p><img src="11.png" alt=""/></p>
                        </div>
                        <div class="post-tail-wrapper text-muted">
                            <div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a
                                    href='../../index.html'>Article</a></div>
                            <div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/gdb/"
                                    class="post-tag no-text-decoration">Hacking</a> <a href="/tags/crontab/"
                                    class="post-tag no-text-decoration">CyberSecurity</a> <a href="/tags/git/"
                                    class="post-tag no-text-decoration">Obfuscation</a> <a href="/tags/hydra/"
                                    class="post-tag no-text-decoration">Computer Security</a>
                                </div>
                        </div>
                    </div>
                </div>
                <!-- The Pannel on right side (Desktop views) v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License -->
                <div id="panel-wrapper" class="col-xl-3 pl-2 text-muted topbar-down">
                    <div id="toc-wrapper" class="pl-0 pr-4 mb-5">
                        <h3 data-toc-skip class="pl-3 pt-2 mb-2">Contents</h3>
                        <nav id="toc" data-toggle="toc"></nav>
                    </div>
                </div>
            </div>
            <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/lozad/dist/lozad.min.js"></script>
            <script type="text/javascript">
                const imgs = document.querySelectorAll('#post-wrapper img');
                const observer = lozad(imgs);
                observer.observe();
            </script>
            <!-- The Footer v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License -->
            <footer class="d-flex w-100 justify-content-center">
                <div class="d-flex justify-content-between align-items-center">
                    <div class="footer-left">
                        <script src="https://www.hackthebox.eu/badge/189220"></script>
                </div>
            </footer>
        </div>
        <!-- The Search results v2.0 https://github.com/cotes2020/jekyll-theme-chirpy © 2017-2019 Cotes Chung MIT License -->
        <div id="search-result-wrapper" class="d-flex justify-content-center unloaded">
            <div class="col-12 col-xl-11 post-content">
                <div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div>
            </div>
        </div>
    </div>
    <div id="mask"></div><a id="back-to-top" href="#" class="btn btn-lg btn-box-shadow" role="button"> <i
            class="fas fa-angle-up"></i> </a>

    <script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.7.3/dest/simple-jekyll-search.min.js"></script>
    <script>
        SimpleJekyllSearch({
            searchInput: document.getElementById('search-input'),
            resultsContainer: document.getElementById('search-results'),
            json: '/assets/js/data/search.json',
            searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="corshinecorshine.github.io{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"><div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>{categories}</div><div><i class="fa fa-tag fa-fw"></i>{tags}</div></div><p>{snippet}</p></div>',
            noResultsText: '<p class="mt-5">Oops! No result founds.</p>'
        });
    </script>
